---
title: 资源分配与调度
date: 2022-10-31 14:05
---
# 银行家算法思想
系统资源分配中避免死锁的**核心思想**。
在银行中，客户申请贷款的数量是有限的，每个客户在第一次申请贷款时要声明完成该项目所需的最大资金量，在满足所有贷款要求时，客户应及时归还。银行家在客户申请的贷款数量不超过自己拥有的最大值时，都应尽量满足客户的需要。在这样的描述中，银行家就好比操作系统，资金就是资源，客户就相当于要申请资源的进程。
## 假设原理
- 当一个顾客对资金的最大需求不超过已有总数就可以接纳顾客
- 顾客可以分期贷款，但总数不能超过最大需求
- 当银行家的现有资金不能满足贷款金额时，可以延迟交付，但需要保证在有限的时间里获得贷款
- 顾客得到所有需要的资金后会归还资金。
- 银行家对每个资源进行检查，若会导致不安全状态则拒绝该请求。
- 检查的方法是看其是否**有足够的资源满足一个距最大需求最近的客户**，并如此反复，若所有投资都被收回，则该状态是安全的
## 数据结构
- 可利用资源向量 Available: 含有 m 个元素的数组，每个元素代表一类可利用的资源的数目
- 最大需求矩阵 Max: 一个 nxm 的矩阵，定义了 n 个进程中每一个进程为第 m 类资源的最大需求
- 分配矩阵 Allocation: 一个 nxm 的矩阵，定义了 n 个进程已经获得的第 m 类资源的数目
- 需求矩阵 Need: 一个 nxm 的矩阵，表示 n 个进程中每个进程还需要第 m 类资源的树木
## 安全状态判断算法
1. 寻找一个没有标记的进程 pi，它的资源请求矩阵 D 的第 i 行向量小于其对应的剩余资源向量
2. 如果找到了这样的进程，则将资源分配矩阵 A 的第 i 行向量加入到 R 中，标记该进程，并回到第一步。若没有找到这样的进程，则转到第三步。
3. 若所有进程都被标记，则系统处于安全状态。

---
# 死锁的检测与解除
资源分配时不加限制，而是定期运行死锁检测程序。
## 资源分配图检测系统死锁状态
- 若进程-资源分配图中有环路，且每个资源类别中仅有一个资源，则环路是死锁的充要条件。
- 若有环路，且涉及的资源类中有多个资源，则环路是死锁的必要不充分条件
## 死锁的解除
- ~~立即结束所有进程的运行，重启系统~~
- ~~撤销死锁的所有进程~~
- 逐个撤销死锁进程，回收资源，直到死锁解除
- 剥夺死锁占用的资源，但不撤销它，直到死锁解除
